# Claude Workbench v4.0.1 发布说明

## 🎉 v4.0.1 - 扩展管理器与成本优化

**发布日期**: 2025-10-26  
**重要性**: 新增扩展管理器，成本计算优化，UI 改进

---

## 🔧 核心修复

### 提示词索引不一致问题 - 已修复

**问题**：
- Warmup 消息导致前后端索引计数不一致
- 撤回功能报错："Prompt #X not found"

**解决方案**：
- ✅ 前后端过滤逻辑完全对齐
- ✅ 支持数组格式 content 解析
- ✅ 索引验证机制，防止越界
- ✅ 统一 Warmup 消息处理

---

## 🎨 UI 优化

### 主题切换

- ✅ 主题切换按钮移至顶栏最前面
- ✅ 一键快速切换（无需进入设置）
- ✅ 圆形图标设计，更醒目
- 🚀 操作速度提升 3 倍（1 步 vs 3 步）

### 撤回功能优化

- ✅ 圆形边框按钮样式
- ✅ 默认可见（无需悬停）
- ✅ 与消息文本并排显示
- ✅ Tooltip 向上显示（不遮挡内容）

### 顶栏紧凑化

- ✅ 按钮尺寸统一为 h-7
- ✅ 图标统一为 3.5x3.5
- ✅ 间距缩小，布局紧凑
- 📏 顶栏高度减少 30%
- 🖥️ 为内容区留出更多空间

---

## 👁️ 用户体验改进

### Warmup 消息处理

- ✅ **默认隐藏** Warmup 消息（开箱即用）
- ✅ 会话列表显示真实提示词
- ✅ 撤回后保持隐藏状态
- ✅ 可在设置中选择显示

**效果**：
- 新用户无需配置，直接获得最佳体验
- 会话列表一目了然
- 对话历史更简洁

### 会话列表优化

- ✅ 跳过 Warmup，显示第一条真实用户输入
- ✅ 支持数组格式 content 解析
- ✅ 去除重复的会话数量显示

---

## 🧹 代码质量提升

### 清理内容

**临时文档** - 删除 12 个：
- 开发过程记录
- Bug 修复记录
- 实现进度文档

**代码优化**：
- 删除 ~40 行注释代码
- 删除未使用的导入
- 清理调试代码
- 整理 TODO 注释

### 代码改进

- ✅ 前后端逻辑对齐
- ✅ 类型安全增强
- ✅ 注释更清晰
- ✅ 可读性提升

---

## ✅ 平台支持

### macOS 完全适配

经过全面审计，确认：
- ✅ Tauri 配置包含 DMG + APP 打包
- ✅ 后端代码有 macOS 条件编译
- ✅ 前端代码天然跨平台
- ✅ Claude CLI 自动检测支持 Homebrew
- ✅ 可以直接在 macOS 上构建和运行

### 平台兼容性

- ✅ **Windows 10/11**: 完全支持（主要开发平台）
- ✅ **macOS**: 完全支持（已验证适配）
- ✅ **Linux**: 理论支持（Tauri 天然支持）

---

## 🆕 v4.0.1 新增功能

### Claude 扩展管理器 ⭐⭐⭐⭐⭐

**顶栏新增"扩展"入口**，可查看：
- **Plugins** - 已安装的插件（包含 commands/agents/skills/hooks/MCP）
- **Subagents** - 专用子代理列表
- **Agent Skills** - 专用技能列表

**功能**：
- ✅ 扫描用户级和项目级扩展
- ✅ 显示插件组件统计
- ✅ 点击卡片直接打开 .md 文件
- ✅ 打开目录浏览所有文件
- ✅ 链接到官方文档和资源

### 成本计算优化 ⭐⭐⭐⭐⭐

**多模型定价支持**：
- ✅ 准确计算混合模型会话成本
- ✅ 支持 Opus 4.1、Sonnet 4.5、Sonnet 3.5
- ✅ 每条消息使用实际模型定价

**详细统计**：
- ✅ 鼠标悬停查看详细信息
- ✅ Token 分类（输入/输出/Cache 读/Cache 写）
- ✅ 会话时长（wall time）
- ✅ API 执行时长
- ✅ 符合官方 /cost 命令格式

### UI/UX 改进 ⭐⭐⭐⭐

**顶栏优化**：
- ✅ 图标和文字紧凑（0px 间距）
- ✅ 按钮间距清晰（4px）
- ✅ 微妙阴影和边框
- ✅ 视觉层次更清晰

**交互优化**：
- ✅ 成本详情悬停显示（不用点击）
- ✅ Popover 定位准确
- ✅ 实心背景清晰可读

### 性能优化 ⭐⭐⭐⭐

- ✅ 修复生产构建加载会话慢的问题
- ✅ 翻译未启用时完全跳过检查
- ✅ 会话历史秒开（与开发模式一致）

---

## 📦 安装方式

### 预构建版本

从 [GitHub Releases](https://github.com/anyme123/claude-workbench/releases/tag/v4.0.1) 下载：

**Windows**:
- MSI 安装包
- NSIS 安装包

**macOS**:
- DMG 安装包
- APP 应用包

### 源码构建

```bash
git clone https://github.com/anyme123/claude-workbench.git
cd claude-workbench
git checkout v4.0.1

# 安装依赖
npm install

# 开发模式
npm run tauri dev

# 构建应用
npm run tauri build
```

---

## 🔄 从 v3.x 升级

### 自动迁移

- ✅ 配置文件自动兼容
- ✅ 数据库自动迁移
- ✅ 会话历史保留

### 新功能默认值

- Warmup 消息：默认隐藏
- 主题切换：顶栏快捷访问

### 无需手动操作

直接安装 v4.0.0 即可，所有设置和数据自动保留。

---

## 🐛 已知问题

目前无已知重大问题。

如发现问题，请在 [GitHub Issues](https://github.com/anyme123/claude-workbench/issues) 报告。

---

## 🙏 致谢

感谢所有为这个项目做出贡献的开发者和用户！

特别感谢：
- [Claude](https://claude.ai/) - 强大的 AI 助手
- [Tauri](https://tauri.app/) - 现代化桌面应用框架
- [React](https://react.dev/) - 用户界面构建库
- [Rust](https://rust-lang.org/) - 系统编程语言

---

## 📋 完整更新日志

### v4.0.1 (2025-10-26)

**新功能**：
- Claude 扩展管理器（Plugins/Subagents/Skills）
- 多模型成本计算（准确定价）
- 成本详情悬停显示（Token 分类、时长统计）
- Git 代码变更统计 API
- 点击打开 .md 文件功能

**性能优化**：
- 会话历史加载速度优化
- 翻译检查优化（未启用时跳过）
- API 时长记录

**UI 改进**：
- 顶栏紧凑设计（图标文字 0px 间距）
- 按钮阴影和边框
- Plan Mode 快捷键对齐官方（单次 Shift+Tab）
- 成本 Popover 定位修复

**Bug 修复**：
- Agent Skill 名称提取
- 目录打开功能（跨平台）
- Rust 编译警告清理

### v4.0.0 (2025-10-26)

**核心修复**：
- 修复提示词索引不一致问题
- 后端支持数组格式 content 解析
- 前后端过滤逻辑完全对齐
- 索引验证机制

**UI 优化**：
- 主题切换按钮移至顶栏
- 撤回按钮样式和布局优化
- 顶栏紧凑化设计
- 去除重复显示

**用户体验**：
- Warmup 消息默认隐藏
- 会话列表显示真实提示词
- 开箱即用的最佳配置

**代码质量**：
- 删除冗余代码和文档
- macOS 完全适配验证
- 依赖包优化

---

**如果这个项目对您有帮助，请给我们一个 ⭐ Star！**

🔗 **项目地址**: https://github.com/anyme123/claude-workbench  
📖 **使用文档**: https://github.com/anyme123/claude-workbench/blob/main/README.md
