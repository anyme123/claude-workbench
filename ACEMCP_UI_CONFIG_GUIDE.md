# ✅ Acemcp 配置 UI 已添加

## 🎯 功能说明

现在用户可以**在应用内通过 UI 配置 acemcp**，无需手动编辑 `settings.toml` 文件。

---

## 🎨 UI 位置

### 访问路径

```
Claude Workbench
  → 点击右上角 "设置" 图标
  → 选择 "提示词优化" 标签
  → 顶部即为 "Acemcp 项目上下文搜索配置"
```

### UI 结构

```
┌────────────────────────────────────────────────┐
│ 🗄️ Acemcp 项目上下文搜索配置        [重置] [保存] │
│ 配置 acemcp 语义搜索引擎的 API 端点和认证信息    │
├────────────────────────────────────────────────┤
│ API Base URL *                                  │
│ [https://api.example.com                    ]  │
│ Acemcp 语义搜索 API 的端点地址                  │
├────────────────────────────────────────────────┤
│ API Token *                              [👁️]  │
│ [••••••••••••••••••••••                    ]  │
│ API 认证令牌                                    │
├────────────────────────────────────────────────┤
│ 批量上传大小              单文件最大行数         │
│ [10              ]        [800            ]    │
│ 默认: 10                  默认: 800             │
├────────────────────────────────────────────────┤
│ [✓ 测试连接]                                   │
├────────────────────────────────────────────────┤
│ 💡 配置保存到 ~/.acemcp/settings.toml          │
│ 启用 "项目上下文" 开关后，优化提示词时会自动    │
│ 调用 acemcp 搜索相关代码                        │
└────────────────────────────────────────────────┘
```

---

## 🔧 功能特性

### 1. 可视化配置

| 字段 | 说明 | 必填 |
|------|------|------|
| API Base URL | 语义搜索 API 端点 | ✅ |
| API Token | 认证令牌 | ✅ |
| 批量上传大小 | 每批文件数 (1-50) | ❌ 默认 10 |
| 单文件最大行数 | 分块大小 (100-5000) | ❌ 默认 800 |

### 2. 安全特性

- **Token 隐藏**: 默认显示为 `••••••`
- **显示切换**: 点击眼睛图标显示/隐藏
- **安全存储**: 保存到用户主目录 `~/.acemcp/settings.toml`

### 3. 状态提示

- **未保存徽章**: 修改后显示橙色 "未保存" 提示
- **保存反馈**: 保存成功后徽章消失
- **测试连接**: 验证 API 配置是否正确

### 4. 一键重置

点击 "重置" 按钮恢复默认值：
- BASE_URL: 空
- TOKEN: 空
- BATCH_SIZE: 10
- MAX_LINES_PER_BLOB: 800

---

## 🚀 用户使用流程

### 首次配置

1. **打开 Claude Workbench**
2. **点击设置按钮**（右上角齿轮图标）
3. **切换到 "提示词优化" 标签**
4. **填写配置**：
   - API Base URL: `https://your-api.com`
   - API Token: `your-token-here`
   - （可选）调整批量大小和行数限制
5. **点击 "测试连接"** 验证配置
6. **点击 "保存配置"**

### 修改配置

1. 打开设置 → 提示词优化
2. 修改任何字段
3. 看到 "未保存" 橙色徽章
4. 点击 "保存配置"

### 使用项目上下文

配置保存后：
1. 打开项目会话
2. 输入提示词
3. 点击 "优化提示词"
4. **启用 "启用项目上下文" 开关**（变蓝）
5. 选择优化模型
6. 系统自动使用配置的 API 搜索代码

---

## 📁 配置文件位置

UI 配置会自动保存到：

**Windows**:
```
C:\Users\<用户名>\.acemcp\settings.toml
```

**macOS**:
```
/Users/<用户名>/.acemcp/settings.toml
```

**Linux**:
```
/home/<用户名>/.acemcp/settings.toml
```

### 文件内容示例

```toml
BASE_URL = "https://api.example.com"
TOKEN = "sk-xxxxxxxxxxxxx"
BATCH_SIZE = 10
MAX_LINES_PER_BLOB = 800
```

---

## 🔍 测试连接功能

点击 "测试连接" 按钮会：

1. **验证必填字段**: 检查 BASE_URL 和 TOKEN 是否填写
2. **调用 acemcp**: 尝试启动 sidecar 并初始化
3. **显示结果**:
   - ✅ 成功: 绿色徽章 "Acemcp 可用！"
   - ❌ 失败: 红色徽章显示错误信息

---

## 💡 与手动配置的对比

### 手动编辑文件

```bash
# 需要手动创建目录
mkdir ~/.acemcp

# 需要记住文件格式
echo 'BASE_URL = "..."' > ~/.acemcp/settings.toml
echo 'TOKEN = "..."' >> ~/.acemcp/settings.toml
```

❌ 需要记住文件路径
❌ 需要记住 TOML 格式
❌ 容易出错
❌ 没有验证

### UI 配置 ✅

```
1. 打开设置
2. 填写表单
3. 点击保存
```

✅ 可视化界面
✅ 自动格式化
✅ 即时验证
✅ 测试连接
✅ 用户友好

---

## 📊 配置页面布局

### 完整设置页面结构

```
设置页面
├── Acemcp 项目上下文搜索配置  ← 新增！
│   ├── API Base URL
│   ├── API Token (可显示/隐藏)
│   ├── 批量上传大小
│   ├── 单文件最大行数
│   └── 测试连接按钮
│
├── 上下文提取配置
│   ├── 最大消息数量
│   ├── 消息长度限制
│   └── 预设模板
│
└── 提示词优化 API 配置
    ├── OpenAI
    ├── Deepseek
    ├── 通义千问
    └── 添加提供商
```

---

## 🎊 总结

### 新增功能

- ✅ Acemcp 配置 UI 组件
- ✅ 保存到 `~/.acemcp/settings.toml`
- ✅ 从文件加载配置
- ✅ Token 显示/隐藏
- ✅ 测试连接功能
- ✅ 未保存提示

### 用户体验

**之前**: 手动编辑 TOML 文件 ❌
**现在**: 可视化 UI 配置 ✅

### 技术实现

- **前端**: `AcemcpConfigSettings.tsx` 组件
- **API**: `saveAcemcpConfig()`, `loadAcemcpConfig()`
- **后端**: Rust TOML 读写功能

---

**现在用户可以在应用内轻松配置 acemcp，无需手动编辑配置文件！** 🎉
